

---
- hosts: server3
  become: yes
  gather_facts: true

  tasks:
    - name: “install zabbix-aggent_ubuntu_1”
      get_url:
        url: "https://repo.zabbix.com/zabbix/6.2/ubuntu/pool/main/z/zabbix-release/zabbix-release_6.2-4%2Bubuntu20.04_all.deb"
        dest: /home/ansible-admin/
      when:
       ansible_os_family == "Debian"

    - name: “install zabbix-aggent_ubuntu_2”
      apt:
        deb: /home/ansible-admin/zabbix-release_6.2-4%2Bubuntu20.04_all.deb
        state: present
      when:
       ansible_os_family == "Debian"

    - name: “install zabbix-aggent_ubuntu_3”
      apt:
        name: "*"
        state: latest
      when:
        ansible_os_family == "Debian"

    - name: “install zabbix-aggent_ubuntu_4”
      apt:
        name: '{{ item }}'
        update_cache: yes
      with_items:
              - zabbix-agent2
              - zabbix-agent2-plugin-*
      when:
        ansible_os_family == "Debian"
      notify:
        zabbix-agent2 systemd

    - name: “install zabbix-aggent_ubuntu_5”
      copy:
        src: /etc/ansible/zabbix_agentd.conf
        dest: /etc/zabbix/zabbix_agent2.conf
      when:
        ansible_os_family == "Debian"

  handlers:
    - name: zabbix-agent2 systemd
      service:
        name: zabbix-agent2
        enabled: yes
        state: started

